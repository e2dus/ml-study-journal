<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê¸€ì“°ê¸° | ML Study Journal</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âœï¸</text></svg>" />
    <style>
        /* ===== Write Page Styles ===== */
        .write-container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 100px 2rem 4rem;
        }

        .write-header {
            margin-bottom: 2rem;
        }

        .write-header h1 {
            font-size: 2rem;
            font-weight: 800;
            background: var(--gradient-blue);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.25rem;
        }

        .write-header p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .write-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        /* Metadata inputs */
        .meta-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .meta-full {
            grid-column: 1 / -1;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-size: 0.78rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-muted);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            padding: 10px 14px;
            outline: none;
            transition: var(--transition);
            width: 100%;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.1);
        }

        .form-group select option {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Editor */
        .editor-panel,
        .preview-panel {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border);
            border-bottom: none;
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .panel-header .dot-row {
            display: flex;
            gap: 5px;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        #markdown-editor {
            flex: 1;
            min-height: 500px;
            font-family: 'Fira Code', monospace;
            font-size: 0.875rem;
            line-height: 1.7;
            resize: none;
            border-radius: 0 0 var(--radius-sm) var(--radius-sm);
            border: 1px solid var(--border);
        }

        /* Preview */
        .preview-content {
            flex: 1;
            min-height: 500px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0 0 var(--radius-sm) var(--radius-sm);
            padding: 1.5rem;
            overflow-y: auto;
            line-height: 1.75;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Markdown preview styles */
        .preview-content h1 {
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--text-primary);
            margin: 1.5rem 0 0.75rem;
        }

        .preview-content h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 1.25rem 0 0.6rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.4rem;
        }

        .preview-content h3 {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 1rem 0 0.5rem;
        }

        .preview-content p {
            margin-bottom: 0.85rem;
        }

        .preview-content code {
            font-family: 'Fira Code', monospace;
            font-size: 0.82rem;
            background: rgba(255, 255, 255, 0.06);
            padding: 2px 6px;
            border-radius: 4px;
            color: var(--accent-cyan);
        }

        .preview-content pre {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 1rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        .preview-content pre code {
            background: none;
            padding: 0;
            color: var(--accent-green);
            font-size: 0.82rem;
        }

        .preview-content ul,
        .preview-content ol {
            padding-left: 1.5rem;
            margin-bottom: 0.85rem;
        }

        .preview-content li {
            margin-bottom: 0.3rem;
        }

        .preview-content blockquote {
            border-left: 3px solid var(--accent-purple);
            padding-left: 1rem;
            color: var(--text-muted);
            margin: 1rem 0;
            font-style: italic;
        }

        .preview-content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }

        .preview-content th {
            background: rgba(255, 255, 255, 0.06);
            padding: 8px 12px;
            text-align: left;
            font-weight: 700;
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .preview-content td {
            padding: 7px 12px;
            border: 1px solid var(--border);
        }

        .preview-content strong {
            color: var(--text-primary);
            font-weight: 700;
        }

        .preview-content a {
            color: var(--accent-blue);
            text-decoration: underline;
        }

        .preview-content hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 1.5rem 0;
        }

        /* Toolbar */
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-bottom: none;
        }

        .toolbar button {
            padding: 5px 10px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Fira Code', monospace;
        }

        .toolbar button:hover {
            background: var(--bg-card-hover);
            border-color: var(--border);
            color: var(--text-primary);
        }

        .toolbar-sep {
            width: 1px;
            background: var(--border);
            margin: 2px 4px;
        }

        /* Action Buttons */
        .write-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        /* Save Modal */
        .save-modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            backdrop-filter: blur(8px);
        }

        .save-modal-overlay.active {
            display: flex;
        }

        .save-modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            padding: 2.5rem;
            max-width: 700px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
        }

        .save-modal h3 {
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .save-modal p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 1rem;
            font-family: 'Fira Code', monospace;
            font-size: 0.75rem;
            color: var(--accent-green);
            overflow-x: auto;
            white-space: pre;
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .copy-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: rgba(99, 179, 237, 0.1);
            border: 1px solid rgba(99, 179, 237, 0.3);
            border-radius: 8px;
            color: var(--accent-blue);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .copy-btn:hover {
            background: rgba(99, 179, 237, 0.2);
        }

        .steps-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin: 1.25rem 0;
        }

        .step-item {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .step-num {
            min-width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--gradient-main);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.78rem;
            font-weight: 800;
            color: white;
        }

        .step-text {
            font-size: 0.875rem;
            color: var(--text-secondary);
            padding-top: 4px;
            line-height: 1.5;
        }

        .step-text strong {
            color: var(--text-primary);
        }

        .step-text code {
            font-family: 'Fira Code', monospace;
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.06);
            padding: 2px 6px;
            border-radius: 4px;
            color: var(--accent-cyan);
        }

        .save-modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: flex-end;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            color: var(--text-primary);
            z-index: 5000;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-lg);
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Char counter */
        .editor-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 14px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 var(--radius-sm) var(--radius-sm);
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        @media (max-width: 900px) {
            .write-layout {
                grid-template-columns: 1fr;
            }

            .meta-row {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 600px) {
            .meta-row {
                grid-template-columns: 1fr;
            }

            #markdown-editor {
                min-height: 300px;
            }

            .preview-content {
                min-height: 300px;
            }
        }
    </style>
</head>

<body>

    <canvas id="bg-canvas"></canvas>

    <!-- Navbar -->
    <nav class="navbar">
        <a href="index.html" class="nav-logo">
            <div class="nav-logo-icon">ğŸ§ </div>
            <span class="nav-logo-text">ML Journal</span>
        </a>
        <ul class="nav-links" id="nav-links">
            <li><a href="index.html#topics">í•™ìŠµ ì£¼ì œ</a></li>
            <li><a href="index.html#notes">í•™ìŠµ ë…¸íŠ¸</a></li>
            <li><a href="index.html#about">ì†Œê°œ</a></li>
        </ul>
        <button class="hamburger" id="hamburger" aria-label="ë©”ë‰´">
            <span></span><span></span><span></span>
        </button>
    </nav>

    <!-- Write Page -->
    <div class="write-container" style="position:relative; z-index:1;">
        <div class="write-header">
            <h1>âœï¸ ìƒˆ ê¸€ ì‘ì„±</h1>
            <p>ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ê¸€ì„ ì‘ì„±í•˜ê³  ì˜¤ë¥¸ìª½ì—ì„œ ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
        </div>

        <!-- Meta Info -->
        <div class="meta-row">
            <div class="form-group meta-full">
                <label>ì œëª© *</label>
                <input type="text" id="post-title" placeholder="ì˜ˆ: PyTorchë¡œ ì²˜ìŒ ë§Œë“œëŠ” CNN ë¶„ë¥˜ê¸°" />
            </div>
            <div class="form-group">
                <label>ì¹´í…Œê³ ë¦¬</label>
                <select id="post-category">
                    <option value="ì§€ë„ í•™ìŠµ">ğŸ¯ ì§€ë„ í•™ìŠµ</option>
                    <option value="ë¹„ì§€ë„ í•™ìŠµ">ğŸ” ë¹„ì§€ë„ í•™ìŠµ</option>
                    <option value="ë”¥ëŸ¬ë‹">ğŸ§  ë”¥ëŸ¬ë‹</option>
                    <option value="ì „ì²˜ë¦¬">âš™ï¸ ë°ì´í„° ì „ì²˜ë¦¬</option>
                    <option value="ëª¨ë¸ í‰ê°€">ğŸ“Š ëª¨ë¸ í‰ê°€</option>
                    <option value="NLP">ğŸ’¬ NLP</option>
                    <option value="ê¸°íƒ€">ğŸ“Œ ê¸°íƒ€</option>
                </select>
            </div>
            <div class="form-group">
                <label>ë‚ ì§œ</label>
                <input type="date" id="post-date" />
            </div>
            <div class="form-group">
                <label>ì½ê¸° ì‹œê°„ (ë¶„)</label>
                <input type="number" id="post-readtime" value="5" min="1" max="60" />
            </div>
            <div class="form-group meta-full">
                <label>ìš”ì•½ (ëª©ë¡ì— í‘œì‹œë  ì„¤ëª…)</label>
                <input type="text" id="post-excerpt" placeholder="ì´ ê¸€ì—ì„œ ë‹¤ë£¨ëŠ” ë‚´ìš©ì„ í•œ ì¤„ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”." />
            </div>
        </div>

        <!-- Editor + Preview -->
        <div class="write-layout">
            <!-- Editor Side -->
            <div class="editor-panel">
                <div class="panel-header">
                    <span>ğŸ“ ë§ˆí¬ë‹¤ìš´ ì—ë””í„°</span>
                    <div class="dot-row">
                        <div class="dot" style="background:#ff5f57"></div>
                        <div class="dot" style="background:#ffbd2e"></div>
                        <div class="dot" style="background:#28ca41"></div>
                    </div>
                </div>
                <div class="toolbar">
                    <button onclick="insertMd('## ', '')">H2</button>
                    <button onclick="insertMd('### ', '')">H3</button>
                    <div class="toolbar-sep"></div>
                    <button onclick="insertMd('**', '**')"><b>B</b></button>
                    <button onclick="insertMd('*', '*')"><i>I</i></button>
                    <button onclick="insertMd('`', '`')">Code</button>
                    <div class="toolbar-sep"></div>
                    <button onclick="insertBlockCode()">```Block</button>
                    <button onclick="insertMd('> ', '')">Quote</button>
                    <div class="toolbar-sep"></div>
                    <button onclick="insertMd('- ', '')">â€¢ List</button>
                    <button onclick="insertMd('1. ', '')">1. List</button>
                    <div class="toolbar-sep"></div>
                    <button onclick="insertTable()">Table</button>
                    <button onclick="insertMd('---', '')">HR</button>
                    <div class="toolbar-sep"></div>
                    <button onclick="insertMd('[ë§í¬í…ìŠ¤íŠ¸](', 'https://)')">ğŸ”—</button>
                </div>
                <textarea id="markdown-editor" placeholder="# ì œëª©

## ì†Œê°œ
ì—¬ê¸°ì— ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”!

## ì½”ë“œ ì˜ˆì‹œ
\`\`\`python
import numpy as np
print('Hello ML!')
\`\`\`

## ê²°ë¡ 
...
"></textarea>
                <div class="editor-footer">
                    <span id="char-count">0ì</span>
                    <span id="line-count">0ì¤„</span>
                </div>
            </div>

            <!-- Preview Side -->
            <div class="preview-panel">
                <div class="panel-header">
                    <span>ğŸ‘ ë¯¸ë¦¬ë³´ê¸°</span>
                    <span id="preview-word-count" style="font-size:0.75rem; color:var(--text-muted);">0 ë‹¨ì–´</span>
                </div>
                <div class="preview-content" id="preview-content">
                    <p style="color:var(--text-muted); text-align:center; margin-top:3rem;">ì™¼ìª½ì— ë§ˆí¬ë‹¤ìš´ì„ ì…ë ¥í•˜ë©´<br />ì—¬ê¸°ì—
                        ë¯¸ë¦¬ë³´ê¸°ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤ âœ¨</p>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="write-actions">
            <button class="btn-secondary" onclick="saveDraft()" style="cursor:pointer;">ğŸ’¾ ì„ì‹œì €ì¥</button>
            <button class="btn-primary" onclick="publishPost()" style="cursor:pointer;">ğŸš€ ë°œí–‰í•˜ê¸°</button>
        </div>
    </div>

    <!-- Save/Publish Modal -->
    <div class="save-modal-overlay" id="save-modal-overlay">
        <div class="save-modal">
            <h3>ğŸš€ ê¸€ ë°œí–‰ ë°©ë²•</h3>
            <p>GitHub PagesëŠ” ì •ì  ì‚¬ì´íŠ¸ë¼ ì•„ë˜ ë°©ë²•ìœ¼ë¡œ ê¸€ì„ ë“±ë¡í•˜ì„¸ìš”. <br />ì•„ë˜ ì½”ë“œë¥¼ <strong>posts.js</strong> íŒŒì¼ì˜ <code>POSTS</code> ë°°ì—´
                ë§¨ ì•ì— ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤!</p>

            <div class="steps-list">
                <div class="step-item">
                    <div class="step-num">1</div>
                    <div class="step-text">ì•„ë˜ ì½”ë“œë¥¼ <strong>ë³µì‚¬</strong>í•˜ì„¸ìš”</div>
                </div>
                <div class="step-item">
                    <div class="step-num">2</div>
                    <div class="step-text"><code>posts.js</code> íŒŒì¼ì„ ì—´ê³  <code>const POSTS = [</code> ë°”ë¡œ ë‹¤ìŒ ì¤„ì—
                        <strong>ë¶™ì—¬ë„£ê¸°</strong></div>
                </div>
                <div class="step-item">
                    <div class="step-num">3</div>
                    <div class="step-text">íŒŒì¼ ì €ì¥ í›„ <strong>GitHubì— push</strong>í•˜ë©´ ì›¹ì‚¬ì´íŠ¸ì— ìë™ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤!</div>
                </div>
            </div>

            <div id="generated-code" class="code-block"></div>
            <button class="copy-btn" onclick="copyCode()">ğŸ“‹ ì½”ë“œ ë³µì‚¬í•˜ê¸°</button>

            <div class="save-modal-actions">
                <button class="btn-secondary" onclick="closeSaveModal()" style="cursor:pointer;">ë‹«ê¸°</button>
                <a href="index.html" class="btn-primary">ë©”ì¸ìœ¼ë¡œ ê°€ê¸° â†’</a>
            </div>
        </div>
    </div>

    <script src="posts.js"></script>
    <script src="script.js"></script>
    <script>
        // ===========================
        // Write Page Logic
        // ===========================

        // Set today's date
        document.getElementById('post-date').value = new Date().toISOString().split('T')[0];

        // ===========================
        // Markdown Parser (simple)
        // ===========================
        function parseMarkdown(md) {
            if (!md) return '';
            let html = md
                // Escape HTML
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');

            // Code blocks (fenced)
            html = html.replace(/```(\w*)\n([\s\S]*?)```/g, (_, lang, code) => {
                return `<pre><code>${code.trim()}</code></pre>`;
            });

            // Inline code
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

            // Headers
            html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
            html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
            html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');

            // HR
            html = html.replace(/^---$/gm, '<hr>');

            // Bold + Italic
            html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');

            // Blockquote
            html = html.replace(/^&gt; (.+)$/gm, '<blockquote>$1</blockquote>');

            // Tables
            html = html.replace(/^\|(.+)\|$/gm, (match) => {
                const cells = match.split('|').filter((c, i, arr) => i > 0 && i < arr.length - 1);
                return '<tr>' + cells.map(c => `<td>${c.trim()}</td>`).join('') + '</tr>';
            });
            html = html.replace(/(<tr>.*?<\/tr>\n?)+/g, (block) => {
                const rows = block.trim().split('\n');
                const firstRow = rows[0].replace(/<td>/g, '<th>').replace(/<\/td>/g, '</th>');
                // Remove separator rows (---|---)
                const cleaned = rows.filter(r => !r.match(/^<tr>(<td>[\s\-:]+<\/td>)+<\/tr>$/));
                if (cleaned.length === 0) return '';
                const header = '<thead>' + cleaned[0].replace(/<td>/g, '<th>').replace(/<\/td>/g, '</th>') + '</thead>';
                const body = cleaned.slice(1).length > 0 ? '<tbody>' + cleaned.slice(1).join('') + '</tbody>' : '';
                return '<table>' + header + body + '</table>';
            });

            // Unordered lists
            html = html.replace(/(^- .+\n?)+/gm, (block) => {
                const items = block.trim().split('\n').map(l => `<li>${l.replace(/^- /, '')}</li>`).join('');
                return '<ul>' + items + '</ul>';
            });

            // Ordered lists
            html = html.replace(/(^\d+\. .+\n?)+/gm, (block) => {
                const items = block.trim().split('\n').map(l => `<li>${l.replace(/^\d+\. /, '')}</li>`).join('');
                return '<ol>' + items + '</ol>';
            });

            // Links
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');

            // Paragraphs (lines not already wrapped in block elements)
            const lines = html.split('\n');
            const result = [];
            for (let line of lines) {
                const trimmed = line.trim();
                if (!trimmed) continue;
                if (/^<(h[1-6]|ul|ol|li|pre|code|table|thead|tbody|tr|th|td|blockquote|hr|div)/.test(trimmed)) {
                    result.push(trimmed);
                } else {
                    result.push('<p>' + trimmed + '</p>');
                }
            }
            return result.join('\n');
        }

        // ===========================
        // Live Preview
        // ===========================
        const editor = document.getElementById('markdown-editor');
        const preview = document.getElementById('preview-content');
        const charCount = document.getElementById('char-count');
        const lineCount = document.getElementById('line-count');
        const wordCount = document.getElementById('preview-word-count');

        let debounceTimer;
        editor.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(updatePreview, 150);
            updateCounts();
        });

        function updatePreview() {
            const md = editor.value;
            if (!md.trim()) {
                preview.innerHTML = '<p style="color:var(--text-muted); text-align:center; margin-top:3rem;">ì™¼ìª½ì— ë§ˆí¬ë‹¤ìš´ì„ ì…ë ¥í•˜ë©´<br/>ì—¬ê¸°ì— ë¯¸ë¦¬ë³´ê¸°ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤ âœ¨</p>';
                return;
            }
            preview.innerHTML = parseMarkdown(md);
        }

        function updateCounts() {
            const text = editor.value;
            charCount.textContent = text.length + 'ì';
            lineCount.textContent = text.split('\n').length + 'ì¤„';
            const words = text.trim().split(/\s+/).filter(w => w).length;
            wordCount.textContent = words + ' ë‹¨ì–´';
        }

        // ===========================
        // Toolbar Helpers
        // ===========================
        function insertMd(before, after) {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const selected = editor.value.substring(start, end);
            const replacement = before + selected + after;
            editor.value = editor.value.substring(0, start) + replacement + editor.value.substring(end);
            editor.selectionStart = start + before.length;
            editor.selectionEnd = start + before.length + selected.length;
            editor.focus();
            updatePreview();
        }

        function insertBlockCode() {
            insertMd('```python\n', '\n```');
        }

        function insertTable() {
            const table = `| í•­ëª© | ë‚´ìš© |
|------|------|
| ê°’1  | ì„¤ëª…1 |
| ê°’2  | ì„¤ëª…2 |`;
            const start = editor.selectionStart;
            editor.value = editor.value.substring(0, start) + '\n' + table + '\n' + editor.value.substring(start);
            editor.focus();
            updatePreview();
        }

        // ===========================
        // Draft Save (localStorage)
        // ===========================
        function saveDraft() {
            const draft = {
                title: document.getElementById('post-title').value,
                category: document.getElementById('post-category').value,
                date: document.getElementById('post-date').value,
                readTime: document.getElementById('post-readtime').value,
                excerpt: document.getElementById('post-excerpt').value,
                content: editor.value
            };
            localStorage.setItem('ml_journal_draft', JSON.stringify(draft));
            showToast('ğŸ’¾ ì„ì‹œì €ì¥ ì™„ë£Œ!');
        }

        // Load draft on page load
        const savedDraft = localStorage.getItem('ml_journal_draft');
        if (savedDraft) {
            try {
                const d = JSON.parse(savedDraft);
                document.getElementById('post-title').value = d.title || '';
                document.getElementById('post-category').value = d.category || 'ì§€ë„ í•™ìŠµ';
                document.getElementById('post-date').value = d.date || '';
                document.getElementById('post-readtime').value = d.readTime || 5;
                document.getElementById('post-excerpt').value = d.excerpt || '';
                editor.value = d.content || '';
                if (d.content) updatePreview();
                updateCounts();
            } catch (e) { }
        }

        // ===========================
        // Publish Post
        // ===========================
        function generateId(title) {
            return title
                .toLowerCase()
                .replace(/[^a-z0-9ê°€-í£\s]/g, '')
                .trim()
                .replace(/\s+/g, '-')
                .substring(0, 50) + '-' + Date.now().toString(36);
        }

        function getCategoryColor(cat) {
            const map = {
                'ì§€ë„ í•™ìŠµ': 'blue',
                'ë¹„ì§€ë„ í•™ìŠµ': 'purple',
                'ë”¥ëŸ¬ë‹': 'orange',
                'ì „ì²˜ë¦¬': 'green',
                'ëª¨ë¸ í‰ê°€': 'cyan',
                'NLP': 'pink',
                'ê¸°íƒ€': 'blue'
            };
            return map[cat] || 'blue';
        }

        function publishPost() {
            const title = document.getElementById('post-title').value.trim();
            const category = document.getElementById('post-category').value;
            const date = document.getElementById('post-date').value;
            const readTime = parseInt(document.getElementById('post-readtime').value);
            const excerpt = document.getElementById('post-excerpt').value.trim();
            const content = editor.value.trim();

            if (!title) { showToast('âš ï¸ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
            if (!content) { showToast('âš ï¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
            if (!excerpt) { showToast('âš ï¸ ìš”ì•½ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }

            const post = {
                id: generateId(title),
                title,
                category,
                categoryColor: getCategoryColor(category),
                date,
                readTime,
                excerpt,
                content
            };

            // Generate code to paste into posts.js
            const escaped = JSON.stringify(post, null, 2)
                .replace(/"content": "(.*?)"/s, (_, c) => {
                    return `"content": \`${c.replace(/\\n/g, '\n').replace(/\\`/g, '`').replace(/\\\\/g, '\\')}\``;
                });

            const jsonStr = JSON.stringify(post, null, 2);
            const codeToAdd = `  {\n    id: "${post.id}",\n    title: "${post.title}",\n    category: "${post.category}",\n    categoryColor: "${post.categoryColor}",\n    date: "${post.date}",\n    readTime: ${post.readTime},\n    excerpt: "${post.excerpt}",\n    content: \`${post.content.replace(/`/g, '\\`')}\`\n  },`;

            document.getElementById('generated-code').textContent = codeToAdd;
            document.getElementById('save-modal-overlay').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Clear draft
            localStorage.removeItem('ml_journal_draft');
        }

        function closeSaveModal() {
            document.getElementById('save-modal-overlay').classList.remove('active');
            document.body.style.overflow = '';
        }

        document.getElementById('save-modal-overlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('save-modal-overlay')) closeSaveModal();
        });

        function copyCode() {
            const code = document.getElementById('generated-code').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showToast('ğŸ“‹ ë³µì‚¬ ì™„ë£Œ! posts.jsì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.');
            }).catch(() => {
                const ta = document.createElement('textarea');
                ta.value = code;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
                showToast('ğŸ“‹ ë³µì‚¬ ì™„ë£Œ!');
            });
        }

        // ===========================
        // Toast Notification
        // ===========================
        function showToast(msg) {
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Keyboard shortcuts
        editor.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveDraft();
            }
            // Auto-indent
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = editor.selectionStart;
                editor.value = editor.value.substring(0, start) + '  ' + editor.value.substring(start);
                editor.selectionStart = editor.selectionEnd = start + 2;
            }
        });
    </script>
</body>

</html>